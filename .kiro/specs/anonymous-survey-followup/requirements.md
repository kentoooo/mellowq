# 要件定義書

## 概要

匿名回答可能なアンケートサービスで、回答者の匿名性を保ちながら、質問作成者が特定の回答に対して追加質問を投げかけることができるシステム。従来のアンケートサービスの一方向的なやり取りを、双方向のコミュニケーションに発展させる。

## 要件

### 要件 1: ログイン不要のアンケート作成機能

**ユーザーストーリー:** 質問作成者として、ログインや登録なしで複数の質問を含むアンケートを作成したい。そうすることで手軽に回答者から情報を収集できる。

#### 受入基準

1. WHEN 質問作成者がアンケート作成画面にアクセスする THEN システムは ログインを要求せずにアンケートタイトル、説明、質問項目を入力できるフォームを表示する
2. WHEN 質問作成者が質問を追加する THEN システムは ラジオボタン（単一選択）、チェックリスト（複数選択）、テキストボックス（自由記述）の質問タイプを選択できる
3. WHEN 質問作成者がラジオボタンまたはチェックリスト質問を作成する THEN システムは 選択肢を追加・編集・削除できる機能を提供する
4. WHEN 質問作成者がアンケートを保存する THEN システムは 一意のアンケートURLと管理用URLを生成し、共有可能にする
5. WHEN アンケートが作成される THEN システムは 質問作成者に管理用URLを提供し、このURLでのみアンケート管理が可能になる

### 要件 2: 匿名回答機能

**ユーザーストーリー:** 回答者として、個人情報を明かすことなくアンケートに回答したい。そうすることで安心して率直な意見を提供できる。

#### 受入基準

1. WHEN 回答者がアンケートURLにアクセスする THEN システムは ログインや個人情報入力を要求せずに回答フォームを表示する
2. WHEN 回答者が回答を送信する THEN システムは 回答者の身元を特定できない一意の匿名IDを生成する
3. WHEN 回答が保存される THEN システムは 回答内容と匿名IDのみを関連付けて保存する

### 要件 3: 追加質問機能

**ユーザーストーリー:** 質問作成者として、特定の匿名回答に対して追加の質問を投げかけたい。そうすることでより深い洞察を得ることができる。

#### 受入基準

1. WHEN 質問作成者が回答一覧を確認する THEN システムは 各匿名回答に「追加質問」ボタンを表示する
2. WHEN 質問作成者が特定の回答に追加質問を作成する THEN システムは その匿名IDに紐づいた追加質問を保存する
3. WHEN 追加質問が作成される THEN システムは 対象の匿名回答者にのみ通知を送信する

### 要件 4: 追加質問通知・回答機能

**ユーザーストーリー:** 匿名回答者として、自分の回答に対する追加質問に気づき、回答したい。そうすることで質問作成者とのやり取りを継続できる。

#### 受入基準

1. WHEN 匿名回答者に追加質問が送られる THEN システムは 匿名IDに基づいた専用URLを生成し、通知する
2. WHEN 追加質問が作成される AND 匿名回答者がブラウザ通知を許可している THEN システムは ブラウザ通知を送信する
3. WHEN 匿名回答者が専用URLにアクセスする THEN システムは 元の回答内容と新しい追加質問を表示する
4. WHEN 匿名回答者が追加質問に回答する THEN システムは 同じ匿名IDで回答を関連付けて保存する
5. IF 匿名回答者が追加質問に回答しない THEN システムは 一定期間後に質問を無効化する

### 要件 7: ブラウザ通知機能

**ユーザーストーリー:** 匿名回答者として、追加質問が投げかけられた時にリアルタイムで通知を受け取りたい。そうすることで迅速に対応できる。

#### 受入基準

1. WHEN 匿名回答者が初回アンケートに回答する THEN システムは ブラウザ通知の許可を求める
2. WHEN 匿名回答者が通知を許可する THEN システムは 通知設定を匿名IDに関連付けて保存する
3. WHEN 質問作成者が追加質問を送信する THEN システムは 対象の匿名回答者にブラウザ通知を送信する
4. WHEN ブラウザ通知がクリックされる THEN システムは 追加質問の専用URLに自動的にリダイレクトする

### 要件 8: ログイン不要システムのセキュリティ

**ユーザーストーリー:** システム利用者として、ログイン不要でも適切なセキュリティが保たれていることを確信したい。そうすることで安心してサービスを利用できる。

#### 受入基準

1. WHEN アンケートまたは管理用URLが生成される THEN システムは 推測困難な長い文字列を使用する
2. WHEN 不正なアクセスが検出される THEN システムは レート制限やアクセス制御を適用する
3. WHEN URLが共有される THEN システムは URLの有効期限設定機能を提供する（オプション）
4. WHEN システムがデータを保存する THEN システムは 最小限の情報のみを保存し、不要なメタデータは記録しない

### 要件 5: 匿名性保護機能

**ユーザーストーリー:** 回答者として、追加のやり取りがあっても完全に匿名性が保たれることを確信したい。そうすることで安心して継続的に回答できる。

#### 受入基準

1. WHEN システムが匿名IDを生成する THEN システムは IPアドレス、ブラウザ情報、時刻などから身元を特定できない方式を使用する
2. WHEN 質問作成者が回答を確認する THEN システムは 匿名ID以外の個人特定可能な情報を表示しない
3. WHEN 追加質問のやり取りが発生する THEN システムは 同一の匿名IDを維持し、新しい識別子を生成しない

### 要件 6: ログイン不要の回答管理・分析機能

**ユーザーストーリー:** 質問作成者として、ログインなしで収集した回答と追加質問のやり取りを整理して分析したい。そうすることで有意義な洞察を得ることができる。

#### 受入基準

1. WHEN 質問作成者が管理用URLにアクセスする THEN システムは ログインを要求せずに全回答の一覧と統計情報を表示する
2. WHEN 質問作成者が特定の匿名回答を選択する THEN システムは その回答者との全てのやり取り履歴を時系列で表示する
3. WHEN 複数の追加質問が存在する THEN システムは 各匿名回答者との対話スレッドを整理して表示する
4. WHEN 管理用URLが第三者に知られる THEN システムは URLの複雑性により不正アクセスを防ぐ